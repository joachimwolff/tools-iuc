<tool id="hicgan_predict" name="Hi-cGAN Predict" version="1.0.0" profile="23.0">
    <description>Predict Hi-C contact maps using Hi-cGAN</description>
    <requirements>
        <requirement type="package" version="3.11">python</requirement>
        <requirement type="package">click</requirement>
        <requirement type="package">cooler</requirement>
        <requirement type="package">graphviz</requirement>
        <requirement type="package">matplotlib</requirement>
        <requirement type="package">numpy</requirement>
        <requirement type="package">pandas</requirement>
        <requirement type="package">pybigwig</requirement>
        <requirement type="package">pydot</requirement>
        <requirement type="package">scikit-learn</requirement>
        <requirement type="package">scipy</requirement>
        <requirement type="package">tqdm</requirement>
        <requirement type="package">optuna</requirement>
        <requirement type="package">icecream</requirement>
        <requirement type="package">ray-tune</requirement>
        <requirement type="package">hyperopt</requirement>
        <requirement type="package" version="2.15">tensorflow-gpu</requirement>

    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        bash $__tool_directory__/run_tool.sh && 
        mkdir -p input_folder/ &&
        #for $bw in $bigwigs
        cp "$bw" input_folder/CTCF.bw &&
        #end for
        echo "${model.fields.path}" &&
        ls -lah "${model.fields.path}" &&
        ln -s "${model.fields.path}" model.keras &&
        #set $input_folder="input_folder/"
        which hicPredict &&
        ls -lah input_folder/ &&
        hicPredict --trainedModel model.keras
            --predictionChromosomesFolders '$input_folder' 
            --predictionChromosomes "${chromosomes.replace(',', ' ')}" 
            --matrixOutputName '$output' 
            --parameterOutputFile '$param_output' 
            -o . 
            --multiplier 2000 
            --binSize "${model.fields.binsize}" 
            --batchSize "${model.fields.batchsize}" 
            --windowSize "${model.fields.windowsize}"
        ]]>
    </command>
    <inputs>
        <param name="model" type="select" label="Preinstalled Model">
            <options from_data_table="hicgan_models" />
        </param>
        <param name="bigwigs" type="data" format="bigwig" multiple="true" label="Input Chromatin Files" help="Select one or more bigWig files as input."/>
        <param name="chromosomes" type="text" label="Prediction Chromosomes (comma-separated)" value="chr4" help="Enter chromosomes separated by commas, e.g., chr1,chr2,chr3"/>
        <!-- <param name="param_output" type="text" label="Parameter Output File" value="params.txt"/> -->

    </inputs>
    <outputs>
        <data name="output" format="cool" label="Predicted Hi-C contact map"/>
        <data name="param_output" format="txt" label="Parameter Output File"/>
    </outputs>
    <help><![CDATA[
This tool predicts Hi-C contact maps from chromatin folders using a pre-trained HiC-GAN model.

**Inputs:**
- Chromatin folder containing bigWig files.
- Select a preinstalled model.
- Chromosomes to predict.
- Output file for parameters.

**Output:**
- A .cool file containing the predicted Hi-C contact map.
- A .txt file with prediction parameters.
    ]]>
    </help>
</tool>
<tool id="schicexplorer_schicmanagescool" name="@BINARY@" version="@WRAPPER_VERSION@.0">
    <description>manage scool Hi-C matrices files</description>
    <macros>
        <token name="@BINARY@">scHicManageScool</token>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        @BINARY@

        --matrix '$matrix_scooler'

        --action $action_conditional.action_selector
        #if $action_conditional.action_selector != 'update':
            #if $action_conditional.action_selector.cellList:
                --cellList $action_conditional.action_selector.cellList
            #end if
        #end if

        #set $output_format = 'scool'
        #if $action_conditional.action_selector == 'extractToCool':
            #set $output_format = 'cool'
        #end if
        --outFileName outfile.$output_format

        --threads @THREADS@

        && mv outfile.$output_format outfile

    ]]></command>
    <inputs>
        
        <expand macro="matrix_scooler_macro"/>
        <conditional name="action_conditional">
            <param name="action_selector" type="select" label="Action to take apply on matrices:">
                    <option value="extractToCool" selected="True">Extract individual cool files</option>
                    <option value="extractScool" selected="True">Extract a subset of cells to scool</option>
                    <option value="update" >Update scHiCExplorer version 4 scool files to version greater 6</option>
            </param>
            <when value='update' />

            <when value='extractToCool'>
                <param name='cellList' type='data' format='tabular' label='List of cells to consider' help='Optional parameter to extract a given list of cell from the scool file.'/>
            </when>
            <when value='extractScool'>
                <param name='cellList' type='data' format='tabular' label='List of cells to consider' help='Optional parameter to extract a given list of cell from the scool file.'/>
            </when>
        </conditional>
        <param name='chromosomes' type='text' label='List of chromosomes to consider' help='Please separate the chromosomes by space'/>
        <param name='createSubmatrix' type='integer' optional='true' label='Keep only the first n matrices' help='Keep only first n matrices and remove the rest. Good for test data creation.'/>

    </inputs>
    <outputs>
        <data name="outFileName" from_work_dir="outfile" format="scool" label="${tool.name} on ${on_string}: scHi-C matrix">
            <change_format>
                <when input="action_conditional.action_selector" value="extractToCool" format="cool" />
            </change_format>
        </data>
    </outputs>
    <tests>
        <test>
            <param name='matrix_scooler' value='test_matrix.scool' />
            <param name='clusterMethod_selector' value='keep' />
            <param name='chromosomes' value='chr1 chr2 chr3 chr4 chr5 chr6 chr7 chr8 chr9 chr10 chr11 chr12 chr13 chr14 chr15 chr16 chr17 chr18 chr19 chrX' />
            <output name="outFileName" ftype="scool">
                <assert_contents>
                    <has_h5_keys keys='Diploid_1_CGTACTAG_AAGGAGTA_R1fastqgz, Diploid_1_CGTACTAG_AAGGAGTA_R1fastqgz/bins, 
                    Diploid_2_AGGCAGAA_AAGGAGTA_R1fastqgz/pixels/count'/>
                </assert_contents>
            </output>
        </test>
       
    </tests>
    <help><![CDATA[

Adjust all matrices
===================

scHicAdjustMatrix is a tool to keep or remove a list of chromosomes of all Hi-C matrices stored in the scool file.

For more information about scHiCExplorer please consider our documentation on readthedocs.io_

.. _readthedocs.io: http://schicexplorer.readthedocs.io/
]]></help>
    <expand macro="citations" />

</tool>

<tool id="schicexplorer_schicplotconsensusmatrices" name="@BINARY@" version="@WRAPPER_VERSION@.0">
    <description>plot single-cell Hi-C interaction matrices cluster consensus matrices</description>
    <macros>
        <token name="@BINARY@">scHicPlotConsensusMatrices</token>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        @BINARY@

        --matrix $matrix_scooler
        #if $chromosome_region_conditional.chromosome_region_selection == 'chromosomes':
            #if $chromosome_region_conditional.chromosomes:
                #set $chromosome = ' '.join([ '\'%s\'' % $chrom for $chrom in str($chromosome_region_conditional.chromosomes).split(' ') ])
                --chromosomes $chromosome
            #end if
        #else if $chromosome_region_conditional.chromosome_region_selection == 'region':
            #if $chromosome_region_conditional.region:
                --region $chromosome_region_conditional.region
            #end if
        #end if
        #if $colormap:
            --colorMap $colormap
        #end if
        #if $dpi:
            --dpi $dpi
        #end if 
        --fontsize $fontsize
        $no_header
        $individual_scale
        --outFileName plot.$image_file_format

        --threads @THREADS@

        && mv plot.$image_file_format plot

    ]]></command>
    <inputs>
        <expand macro="matrix_scooler_macro"/>
        <conditional name="chromosome_region_conditional">
            <param name='chromosome_region_selection' label='Restrict plot' type='select'>
                <option value='no' selected='true'>All data</option>
                <option value='chromosomes'>Chromosomes</option>
                <option value='region'>region</option>
            </param>
            <when value='no' />
            <when value='chromosomes' >
                <param name='chromosomes' type='text' label='List of chromosomes to consider' help='Please separate the chromosomes by space'/>
            </when>
            <when value='region'>
                <param name='region' type='text' label='Region to consider' help='Please use the format chr:10-11'/>
            </when>
        </conditional>
        <expand macro="colormap" />
        <param name='dpi' type='integer' label='DPI for the image' help='Change the default resolution of the plot.' optional='true'/>
        <param name='fontsize' type='integer' value='10' label='Font size for the image' help='Change the default font size of the plot' optional='true'/>
        <param name='no_header' type='boolean' truevalue='--no_header'  falsevalue='' label='Do not plot a header'/>
        <param name='log1p' type='boolean' truevalue='--log1p'  falsevalue='' label='log1p' help='Apply log1p operation to plot the matrices.'/>
        <param name='individual_scale' type='boolean' truevalue='--individual_scale'  falsevalue='' label='Individual scale' help='Use an individual value range for all cluster consensus matrices. If not set, the same scale is applied to all.'/>
        
        <param name="image_file_format" type="select" label="Image output format">
            <option value="png" selected="True">png</option>
            <option value="svg">svg</option>
            <option value="pdf">pdf</option>
        </param>
        
    </inputs>
    <outputs>
        <data name='output_plot' from_work_dir='plot' format='png' label='Consensus matrix plot on ${on_string}'>
            <change_format>
                <when input="image_file_format" value="svg" format="svg" />
                <when input="image_file_format" value="pdf" format="pdf" />
            </change_format>
        </data>
    </outputs>
    <tests>
        <test>
            <param name='matrix_scooler' value='scHicConsensusMatrices/consensus_matrix.scool' />
            <param name="image_file_format" value="png" />
            <param name="dpi" value="300" />
            <output name="output_plot" file="scHicPlotConsensusMatrices/plot.png" ftype="png" compare="sim_size" delta="35000"/>        
        </test>
         <test>
            <param name='matrix_scooler' value='scHicConsensusMatrices/consensus_matrix.scool' />
            <param name="image_file_format" value="png" />
            <param name="dpi" value="300" />
            <param name="chromosomes" value="chr1 chr2" />

            <output name="output_plot" file="scHicPlotConsensusMatrices/plot_chr1_chr2.png" ftype="png" compare="sim_size" delta="35000"/>        
        </test>
       
    </tests>
    <help><![CDATA[

Plot consensus matrices
=======================

scHicPlotConsensusMatrices plots the consensus (average) matrix of a cluster. This tool is useful to compare the single cell clusters.

.. image:: $PATH_TO_IMAGES/consensus_svl_spectral.png
   :width: 50%

For more information about scHiCExplorer please consider our documentation on readthedocs.io_

.. _readthedocs.io: http://schicexplorer.readthedocs.io/
]]></help>
    <expand macro="citations" />

</tool>